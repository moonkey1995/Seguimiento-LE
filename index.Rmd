---
title: Variaciones de "Las Estrellas"
author: "Lunes a Viernes"
output: 
  flexdashboard::flex_dashboard:
    logo: "TelevisaU2.jpg"
    theme: united
    vertical_layout: scroll
params:
  date:
    input: date
    label: "Selecciona la fecha que deseas:"
    max: '2025-12-31'
    min: '2017-01-01'
    value: !r Sys.Date()+3
---

<style>
.colored {
  background-color: #DDDDDD;
}
.colored1 {
  background-color: black;
  color: white;
}
.navbar {
    background: linear-gradient(to right, #ea1e63,#fb3f04);
}
.navbar-brand {
  font-family:  calibri light;
}
.navbar-inverse .navbar-nav li.active a {
  background-color: #ea1e63!important;
  font-family:  calibri light;
}
.navbar .navbar-nav .nav-link:hover {
background-color: #ea1e63; 
font-family:  calibri light;
} 
.navbar .navbar-nav .nav-link:focus {
background-color: #ea1e63; 
font-family:  calibri light;
}
.navbar .navbar-nav{
font-family:  calibri light;
}
.value-box > .inner {
    color: black;
    padding: 10px;
    padding-left: 18px;
    padding-right: 18px;
}
div.scroll{
    max.height:200px;
    overflow:scroll;
}
.nav-tabs-custom .nav-tabs li.active a {
  font-size: 14px;
  color: #fdefec;
  background-color: #ee644a;
  font-family:  calibri light;
  font-weight: bold;
}
.nav-tabs-custom .nav-tabs li:not(.active) a {
  font-size: 14px;
  font-family:  calibri light;
}

.plotly .gtitle {font-size: 12px !important;}
.plotly .xtick text { font-size: 10px !important; }
.plotly .ytick text { font-size: 10px !important; }

</style>


```{r setup, include=FALSE}
options(digits=22,scipen = 999)

# paquetes
require(rio)
require(shinydashboard)
require(tidyverse)
require(flexdashboard)
require(reshape)
require(dplyr)
require(lubridate)
require(ggplot2)
require(tibble)
require(data.table)
require(reshape2)
require(cowplot)
require(shiny)
require(kableExtra)
require(knitr)
require(gridExtra)
require(readxl)
require(stringr)
require(formattable)
require(caret)
require(plotly)
require(ggrepel)
library(ggplot2)
library(fpp2)
library(zoo)
library(tseries)
library(ggrepel)
require(purrr)
```

```{r, include=FALSE}
ruta<-paste(getwd())

data<-read_excel(paste0(ruta,"/Programmes Seguimiento LE_2.xlsx"),skip=2,
                 col_types = c("text","text","date","text","text","text","numeric"))#%>% 
 # mutate(`Main Title`=ifelse(`Main Title`=="PIENSA RAPIDO VIP","PIENSA RAPIDO",`Main Title`))
Data<-data %>% mutate(Horas=as.numeric(substr(`Time (sec)`,1,2)),Minutos=as.numeric(substr(`Time (sec)`,4,5)),
                      Minutos_n=ifelse(Minutos%%6==0,Minutos,Minutos+(10-Minutos%%10)))

Data<-Data %>% filter(weekdays(Date)%in%c("lunes","martes","mi茅rcoles","jueves","viernes")) %>% filter(`Main Title`!="HOY CELEBREMOS") %>% 
  mutate(Horas=ifelse(Minutos_n==60,Horas+1,Horas),Minutos_n=ifelse(Minutos_n==60|Minutos_n==10,0,Minutos_n)) %>% 
  mutate(Inicio=paste0(ifelse(nchar(Horas)==1,"0",""),Horas,":",ifelse(nchar(Minutos_n)==1,"0",""),Minutos_n))

unique(Data$Inicio)
Final<-Data %>% filter(Inicio%in%c("07:00" ,"08:00" ,"09:00", "12:00" ,"13:30", "14:30" ,
                            "15:30" ,"16:30","18:30", "19:30", "20:30" ,"21:30", "22:30")) %>% 
  mutate(Fin=case_when(Inicio=="07:00"~"08:00",Inicio=="08:00"~"09:00",
                       Inicio=="09:00"~"12:00",Inicio=="12:00"~"13:30",
                       Inicio=="13:30"~"14:30",Inicio=="14:30"~"15:30",
                       Inicio=="15:30"~"16:30",Inicio=="16:30"~"18:30",
                       Inicio=="18:30"~"19:30",Inicio=="19:30"~"20:30",
                       Inicio=="20:30"~"21:30",Inicio=="21:30"~"22:30",
                       Inicio=="22:30"~"23:07")) 

### Par谩metros

today<-Sys.Date()-1
twomonths<-today-55
S1_U<-twomonths-1
S1_L<-S1_U-6
S2_U<-S1_L-1
S2_L<-S2_U-6
S3_U<-S2_L-1
S3_L<-S3_U-6
S4_U<-S3_L-1
S4_L<-S4_U-6
M1_U<-S4_L-1
M1_L<-M1_U-29
M2_U<-M1_L-1
M2_L<-M2_U-29
M3_U<-M2_L-1
M3_L<-M3_U-29
Sem<-M3_L-1
lastyear<-Sem-180

### Serie franjas 
Franjas<-read_excel(paste0(ruta,"/Time LE Franjas_2.xlsx"),skip=3,
                    col_types = c("text","text","date","text","numeric","text")) %>% 
  select(-6) %>% mutate(Inicio=substr(`Time (sec)`,1,5))
```


```{r include=FALSE}
# La Funci贸n

Serie<-function(franja){
  ##franja<-"14:30"
  ## filtro diario
  filtro<-Final %>% filter(Inicio==franja) 
  filtro<-filtro %>% 
  mutate(rat_prev=c(NA,`Rtg (000)`[1:nrow(filtro)-1]),variaci贸n=(`Rtg (000)`/rat_prev-1)*100)
  
  ## filtro promedios
  filtro2<-Franjas %>% filter(Inicio==franja)
S9<-filtro2 %>% filter(Date>=S1_L,Date<=S1_U) %>% group_by(Inicio) %>% 
  summarise(Rat_miles=mean(`Rtg (000)`)) %>% mutate(Date="S9")
S10<-filtro2 %>% filter(Date>=S2_L,Date<=S2_U)%>% group_by(Inicio) %>% 
  summarise(Rat_miles=mean(`Rtg (000)`)) %>% mutate(Date="S10")
S11<-filtro2 %>% filter(Date>=S3_L,Date<=S3_U)%>% group_by(Inicio) %>% 
  summarise(Rat_miles=mean(`Rtg (000)`)) %>% mutate(Date="S11")
S12<-filtro2 %>% filter(Date>=S4_L,Date<=S4_U)%>% group_by(Inicio) %>% 
  summarise(Rat_miles=mean(`Rtg (000)`)) %>% mutate(Date="S12")
M4<-filtro2 %>% filter(Date>=M1_L,Date<=M1_U)%>% group_by(Inicio) %>% 
  summarise(Rat_miles=mean(`Rtg (000)`)) %>% mutate(Date="M4")
M5<-filtro2 %>% filter(Date>=M2_L,Date<=M2_U)%>% group_by(Inicio) %>% 
  summarise(Rat_miles=mean(`Rtg (000)`)) %>% mutate(Date="M5")
M6<-filtro2 %>% filter(Date>=M3_L,Date<=M3_U)%>% group_by(Inicio) %>% 
  summarise(Rat_miles=mean(`Rtg (000)`)) %>% mutate(Date="M6")
S1<-filtro2 %>% filter(Date>=lastyear,Date<=Sem)%>% group_by(Inicio) %>% 
  summarise(Rat_miles=mean(`Rtg (000)`)) %>% mutate(Date="Semestre")

Promedios<-rbind(S1,M6,M5,M4,S12,S11,S10,S9) 

###unir bases

Diario<-filtro %>% select(Date,`Main Title`,`Rtg (000)`,Inicio,rat_prev,`variaci贸n`) %>% arrange(Date) %>%  mutate(Date=as.character.Date(Date))
Promedios_F<-Promedios %>% mutate(`Main Title`="Promedio",`Rtg (000)`=Rat_miles,rat_prev=NA,`variaci贸n`=NA)%>% select(Date,`Main Title`,`Rtg (000)`,Inicio,rat_prev,`variaci贸n`)
ind<-which(abs(Diario$variaci贸n)>10)
dias<-Diario[ind,]%>% arrange(by=desc(abs(`variaci贸n`)),) %>% mutate(`Rtg (000)`=round(`Rtg (000)`,0),rat_prev=round(rat_prev,0),`variaci贸n`=`variaci贸n`%>% round(1)) 
FINAL<-rbind(Promedios_F,Diario) %>% mutate(Date=factor(Date,levels=c(unique(Promedios_F$Date[-1]),unique(Diario$Date))))
unique(FINAL$Date)
levels(FINAL$Date)

## la gr谩fica

P<-plot_ly(FINAL[-1,],x=~Date,y=~`Rtg (000)`, color=~`Main Title`,colores=c('forestgreen','orangered',"darkmagenta") , type = 'scatter',mode="lines-markers",hoverinfo = 'text',
                   text = ~paste('</br> Programa ', `Main Title`,
                                 '</br> Fecha ', Date,
                                 '</br> Rat miles: ', round(`Rtg (000)`,0),
                                 '</br> Variaci贸n: ', round(`variaci贸n`,1),"%"))%>% add_trace(y=~`Rtg (000)`,  mode = 'markers',symbols="square",color~ `Main Title`) %>% 
  layout(title = paste(filtro$`Main Title`[nrow(filtro)]),
         xaxis = list(title = 'Fecha'),
         yaxis = list(title = 'Rating miles'),annotations = list(
    list(x = 0.17, y = 1, text = paste("(-) Semestre: ",round(FINAL[1,3],0)), showarrow = FALSE, xref='paper', yref='paper'))
  )%>% hide_legend()

Diario<-Diario %>% mutate(Type=ifelse(`variaci贸n`>0,"Positiva","Negativa"))
v<-Diario %>% ggplot(aes(x = Date, y = `variaci贸n`)) +
  geom_segment(aes(x = Date, xend = Date, y = 0, yend = `variaci贸n`, col = Type)) +
  geom_point(size = 1, pch = 21,bg="black")+scale_color_manual(values=c("red","forestgreen"))+theme_minimal()+theme(axis.text.x = element_text(angle = 270))+geom_text_repel(label=Diario$`variaci贸n`)+geom_hline(aes(yintercept=10),linetype="dashed",lwd=0.5,col="gray")+geom_hline(aes(yintercept=-10),linetype="dashed",lwd=0.5,col="gray")+geom_hline(aes(yintercept=20),linetype="dotted",lwd=0.5,col="gray")+geom_hline(aes(yintercept=-20),linetype="dotted",lwd=0.5,col="gray")+geom_hline(aes(yintercept=30),linetype="longdash",lwd=0.5,col="gray")+geom_hline(aes(yintercept=-30),linetype="longdash",lwd=0.5,col="gray")

V<-ggplotly(v)%>% 
  layout(title = paste("Variaciones de",Diario$`Main Title`[nrow(Diario)]),
         xaxis = list(title = 'Fecha'),
         yaxis = list(title = 'Variaci贸n'))%>% hide_legend()


return(list(P,V,FINAL,dias))
}


SerieGrid<-function(franja){
  ##franja<-"22:30"
  ## filtro diario
  filtro<-Final %>% filter(Inicio==franja) 
  filtro<-filtro %>% 
  mutate(rat_prev=c(NA,`Rtg (000)`[1:nrow(filtro)-1]),variaci贸n=(`Rtg (000)`/rat_prev-1)*100)
  
  ## filtro promedios
  filtro2<-Franjas %>% filter(Inicio==franja)
S9<-filtro2 %>% filter(Date>=S1_L,Date<=S1_U) %>% group_by(Inicio) %>% 
  summarise(Rat_miles=mean(`Rtg (000)`)) %>% mutate(Date="S9")
S10<-filtro2 %>% filter(Date>=S2_L,Date<=S2_U)%>% group_by(Inicio) %>% 
  summarise(Rat_miles=mean(`Rtg (000)`)) %>% mutate(Date="S10")
S11<-filtro2 %>% filter(Date>=S3_L,Date<=S3_U)%>% group_by(Inicio) %>% 
  summarise(Rat_miles=mean(`Rtg (000)`)) %>% mutate(Date="S11")
S12<-filtro2 %>% filter(Date>=S4_L,Date<=S4_U)%>% group_by(Inicio) %>% 
  summarise(Rat_miles=mean(`Rtg (000)`)) %>% mutate(Date="S12")
M4<-filtro2 %>% filter(Date>=M1_L,Date<=M1_U)%>% group_by(Inicio) %>% 
  summarise(Rat_miles=mean(`Rtg (000)`)) %>% mutate(Date="M4")
M5<-filtro2 %>% filter(Date>=M2_L,Date<=M2_U)%>% group_by(Inicio) %>% 
  summarise(Rat_miles=mean(`Rtg (000)`)) %>% mutate(Date="M5")
M6<-filtro2 %>% filter(Date>=M3_L,Date<=M3_U)%>% group_by(Inicio) %>% 
  summarise(Rat_miles=mean(`Rtg (000)`)) %>% mutate(Date="M6")
S1<-filtro2 %>% filter(Date>=lastyear,Date<=Sem)%>% group_by(Inicio) %>% 
  summarise(Rat_miles=mean(`Rtg (000)`)) %>% mutate(Date="Semestre")

Promedios<-rbind(S1,M6,M5,M4,S12,S11,S10,S9) 

###unir bases

Diario<-filtro %>% select(Date,`Main Title`,`Rtg (000)`,Inicio,rat_prev,`variaci贸n`) %>% arrange(Date) %>%  mutate(Date=as.character.Date(Date))
Promedios_F<-Promedios %>% mutate(`Main Title`="Promedio",`Rtg (000)`=Rat_miles,rat_prev=NA,`variaci贸n`=NA)%>% select(Date,`Main Title`,`Rtg (000)`,Inicio,rat_prev,`variaci贸n`)

FINAL<-rbind(Promedios_F,Diario) %>% mutate(Date=factor(Date,levels=c(unique(Promedios_F$Date[-1]),unique(Diario$Date))))
unique(FINAL$Date)
levels(FINAL$Date)

## la gr谩fica

P<-plot_ly(FINAL[-1,],x=~Date,y=~`Rtg (000)`, color=~`Main Title`,colores=c('forestgreen','orangered',"darkmagenta") , type = 'scatter',mode="lines-markers",hoverinfo = 'text',
                   text = ~paste('</br> Programa ', `Main Title`,
                                 '</br> Fecha ', Date,
                                 '</br> Rat miles: ', round(`Rtg (000)`,0),
                                 '</br> Variaci贸n: ', round(`variaci贸n`,1),"%"))%>% add_trace(y=~`Rtg (000)`,  mode = 'markers',symbols="square",color~ `Main Title`) %>% 
  layout(title = list(text=paste(filtro$`Main Title`[nrow(filtro)])),
         xaxis = list(title = 'Fecha' ),
         yaxis = list(title = 'Rating miles')
  )%>% hide_legend()


return(list(P,FINAL))
}

```

Franjas {data-orientation=rows }
==========================================================================

Row {.tabset .tabset-fade data-height=850}
-----------------------------------------------------------------------

### 07:00-08:00

<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f7<-Serie("07:00")
f7[[1]]
```
</div>
</div>

<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f7[[2]]
```
</div>
</div>

### 08:00-09:00
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f8<-Serie("08:00")
f8[[1]]
```
</div>
</div>
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f8[[2]]
```
</div>
</div>
### 09:00-12:00
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f9<-Serie("09:00")
f9[[1]]
```
</div>
</div>
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f9[[2]]
```
</div>
</div>
### 12:00-13:30
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f12<-Serie("12:00")
f12[[1]]
```
</div>
</div>
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f12[[2]]
```
</div>
</div>
### 13:30-14:30
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f13<-Serie("13:30")
f13[[1]]
```
</div>
</div>
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f13[[2]]
```
</div>
</div>
### 14:30-15:30
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f14<-Serie("14:30")
f14[[1]]
```
</div>
</div>
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f14[[2]]
```
</div>
</div>
### 15:30-16:30
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f15<-Serie("15:30")
f15[[1]]
```
</div>
</div>
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f15[[2]]
```
</div>
</div>
### 16:30-18:30
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f16<-Serie("16:30")
f16[[1]]
```
</div>
</div>
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f16[[2]]
```
</div>
</div>
### 18:30-19:30
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f18<-Serie("18:30")
f18[[1]]
```
</div>
</div>
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f18[[2]]
```
</div>
</div>
### 19:30-20:30
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f19<-Serie("19:30")
f19[[1]]
```
</div>
</div>
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f19[[2]]
```
</div>
</div>
### 20:30-21:30
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f20<-Serie("20:30")
f20[[1]]
```
</div>
</div>
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f20[[2]]
```
</div>
</div>
### 21:30-22:30
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f21<-Serie("21:30")
f21[[1]]
```
</div>
</div>
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f21[[2]]
```
</div>
</div>
### 22:30-23:07
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f22<-Serie("22:30")
f22[[1]]
```
</div>
</div>
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=4}
f22[[2]]
```
</div>
</div>

Grid {data-orientation=rows }
==========================================================================

Row {.tabset .tabset-fade data-height=500}
-----------------------------------------------------------------------
<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=7}
# Lista de horarios
horarios <- c("07:00","08:00","09:00","12:00","13:30","14:30","15:30","16:30",
              "18:30","19:30","20:30","21:30","22:30")


# Generar lista de plots SIN t铆tulo interno y con tama帽o de texto en eje x
plots <- map(horarios, ~ SerieGrid(.x)[[1]] %>%
               layout(
                 title = NULL,
                 showticklabels = FALSE#  anula t铆tulo local
                 
               ))



# Crear el subplot con escalas libres
p <- subplot(plots, nrows = 4, shareX = TRUE, shareY = FALSE)

# Agregar t铆tulos flotantes
p %>% layout(title = "Grid Series",
  annotations = list(
    list(x = 0.09, y = 1, text = "07:00", showarrow = FALSE, xref='paper', yref='paper'),
    list(x = 0.37,  y = 1, text = "08:00", showarrow = FALSE, xref='paper', yref='paper'),
    list(x = 0.62, y = 1, text = "09:00", showarrow = FALSE, xref='paper', yref='paper'),
    list(x = 0.9, y = 1, text = "12:00", showarrow = FALSE, xref='paper', yref='paper'),
    list(x = 0.09,  y = 0.72, text = "13:30", showarrow = FALSE, xref='paper', yref='paper'),
    list(x = 0.37, y = 0.72, text = "14:30", showarrow = FALSE, xref='paper', yref='paper'),
    list(x = 0.62, y = 0.72, text = "15:30", showarrow = FALSE, xref='paper', yref='paper'),
    list(x = 0.9, y = 0.72, text = "16:30", showarrow = FALSE, xref='paper', yref='paper'),
    list(x = 0.09, y = 0.46, text = "18:30", showarrow = FALSE, xref='paper', yref='paper'),
    list(x = 0.37, y = 0.46, text = "19:30", showarrow = FALSE, xref='paper', yref='paper'),
    list(x = 0.62, y = 0.46, text = "20:30", showarrow = FALSE, xref='paper', yref='paper'),
    list(x = 0.9, y = 0.46, text = "21:30", showarrow = FALSE, xref='paper', yref='paper'),
    list(x = 0.09, y = 0.16, text = "22:30", showarrow = FALSE, xref='paper', yref='paper')
  )
)

```
</div>
</div>

Serie conjunta {data-orientation=rows }
==========================================================================

Row {.tabset .tabset-fade data-height=400}
-----------------------------------------------------------------------

<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r,fig.width=12,fig.height=5}
BaseJunta<-rbind(Serie("07:00")[[3]],Serie("08:00")[[3]],Serie("09:00")[[3]],Serie("12:00")[[3]],Serie("13:30")[[3]],Serie("14:30")[[3]],Serie("15:30")[[3]],Serie("16:30")[[3]],Serie("18:30")[[3]],Serie("19:30")[[3]],Serie("20:30")[[3]],Serie("21:30")[[3]],Serie("22:30")[[3]])
n<-length(levels(BaseJunta$Date))
levels(BaseJunta$Date)<-c(levels(BaseJunta$Date)[1:8],levels(BaseJunta$Date)[9:n] %>% as.Date() %>% sort() %>% as.character.Date())
#BaseJunta %>% ggplot(aes(x=Date,y=`Rtg (000)`,group=Inicio,col=Inicio))+geom_line()

plot_ly(BaseJunta,x=~Date,y=~`Rtg (000)`, color=~`Inicio` , type = 'scatter',mode="lines-markers",hoverinfo = 'text',
                   text = ~paste('</br> Programa ', `Main Title`,
                                 '</br> Franja ', Inicio,
                                 '</br> Fecha ', Date,
                                 '</br> Rat miles: ', round(`Rtg (000)`,0),
                                 '</br> Variaci贸n: ', round(`variaci贸n`,1),"%"))%>% add_trace(y=~`Rtg (000)`,  mode = 'markers',symbols="square",color~ `Inicio`) %>% 
  layout(title = "Rating Miles por franja",
         xaxis = list(title = 'Fecha'),
         yaxis = list(title = 'Rating miles'))%>% hide_legend()
```

</div>
</div>

Resumen {data-orientation=rows }
==========================================================================

Row {.tabset .tabset-fade data-height=400}
-----------------------------------------------------------------------
<center>
<font size="5" color="#424242">D铆as con variaciones mayores al 10% (煤ltimas 8 semanas)</font>
</center>

<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">

<div>
```{r,results='asis'}
Resumen<-rbind(f7[[4]],f8[[4]],f9[[4]],f12[[4]],f13[[4]],f14[[4]],f15[[4]],f16[[4]],f18[[4]],f19[[4]],f20[[4]],f21[[4]],f22[[4]])

tabla<-function(franja){
#franja="07:00"
Filtro<-Resumen %>% filter(Inicio==franja) 
Filtro %>%
  mutate(variaci贸n = cell_spec(Filtro$variaci贸n, bold = TRUE,
                                color = ifelse(Filtro$variaci贸n > 0, "green", "red"))) %>%
  kable(caption = paste(franja), escape = FALSE, format = "html") %>%
  kable_styling(bootstrap_options = "condensed",
                full_width = FALSE, font_size = 12, position = "center")
}
tabla("07:00")
```
</div>
<div>
```{r}
tabla("08:00")
```
</div>
</div>

<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r}
tabla("09:00")
```
</div>
<div>
```{r}
tabla("12:00")
```
</div>
</div>

<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r}
tabla("13:30")
```
</div>
<div>
```{r}
tabla("14:30")
```
</div>
</div>

<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r}
tabla("15:30")
```
</div>
<div>
```{r}
tabla("16:30")
```
</div>
</div>

<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r}
tabla("18:30")
```
</div>
<div>
```{r}
tabla("19:30")
```
</div>
</div>

<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r}
tabla("20:30")
```
</div>
<div>
```{r}
tabla("21:30")
```
</div>
</div>

<div style="display:flex; flex-direction:row; justify-content:space-evenly; align-items:center;">
<div>
```{r}
tabla("22:30")
```
</div>
</div>

